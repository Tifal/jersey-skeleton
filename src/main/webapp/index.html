<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Se connecter à Take & Wash</title>
    <meta charset='utf-8'>
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

	<link rel="stylesheet" type="text/css" href="css/style.css" />
	
    <!-- Code local -->
    <script src="all.js"></script>
</head>
<body>

	<div class="container">
		<div class="login" style="display: block;">
			<div class="title">
				<h1>Se connecter à <strong>Take & Wash</strong></h1>
				<p>Slogan</p>
			</div>
			<div class="card">
				<div class="header">
					<h2>Connexion</h2>
					<p>Entrez votre identifiant et votre mot de passe pour vous connecter:</p>
				</div>
				<div class="content">
					<form class="form-horizontal" role="form" id="login-form">
						<div class="form-group">
							<label class="control-label col-sm-2" for="user">Nom d'utilisateur:</label>
							<div class="col-sm-10">
								<input type="test" class="form-control" id="user" placeholder="Nom d'utilisateur">
								<div class="alert alert-danger" id="user-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="user-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="pwd">Mot de passe:</label>
							<div class="col-sm-10">
								<input type="password" maxlength="42" class="form-control" id="pwd" placeholder="Mot de passe">
								<div class="alert alert-danger" id="pwd-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="pwd-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<div class="checkbox">
									<label><input type="checkbox"> Se souvenir de moi</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<center>
									<button type="button" class="btn btn-large btn-primary" id="btn-action-login">Se connecter</button>
								</center>
							</div>
						</div>
					</form>
				</div>
			</div>
			<br />
			<div class="container">
				<p>
					Pas encore inscrit?<br /><br />
					<button type="button" class="btn btn-large btn-primary" id="btn-register">S'inscrire</button>
				</p>
			</div>
		</div>
		<div class="register" style="display: none;">
			<div class="title">
				<h1>S'inscrire à <strong>Take & Wash</strong></h1>
				<p>slogan</p>
			</div>
			<div class="card">
				<div class="header">
					<h2>Inscription</h2>
					<p>Entrez vos informations pour vous inscrire:</p>
				</div>
				<div class="content">
					<form class="form-horizontal" role="form" id="register-form">
						<div class="form-group">
							<label class="control-label col-sm-2" for="name">Nom et prénom:</label>
							<div class="col-sm-10">
								<input type="text" class="form-control" id="name" placeholder="Nom et prénom">
								<div class="alert alert-danger" id="name-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="name-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="user">Nom d'utilisateur:</label>
							<div class="col-sm-10">
								<input type="text" maxlength="42" class="form-control" id="user" placeholder="Nom d'utilisateur">
								<div class="alert alert-danger" id="user-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="user-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="address">Adresse:</label>
							<div class="col-sm-10">
								<input type="text" maxlength="256" class="form-control" id="address" placeholder="Adresse">
								<div class="alert alert-danger" id="address-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="address-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="pwd">Mote de passe:</label>
							<div class="col-sm-10">
								<input type="password" maxlength="42" class="form-control" id="pwd" placeholder="Mot de passe">
								<div class="alert alert-danger" id="pwd-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="pwd-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="cpwd">Confirmer le mot de passe:</label>
							<div class="col-sm-10">
								<input type="password" maxlength="42" class="form-control" id="cpwd" placeholder="Confirmer le mot de passe">
								<div class="alert alert-danger" id="cpwd-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="cpwd-error-message">Les mots de passes sont différents</strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<center>
									<button type="button" class="btn btn-large btn-primary" id="btn-action-register">S'inscrire</button>
								</center>
							</div>
						</div>
					</form>
				</div>
			</div>
			<br />
			<div class="container">
				<p>
					déjà inscrit?<br /><br />
					<button type="button" class="btn btn-large btn-primary" id="btn-login">Se connecter</button>
				</p>
			</div>
		</div>
	</div>
	<div class="main" style="display: none;">
		<nav class="navbar navbar-default">
			<div class="container-fluid">
			    <div class="navbar-header">
			      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			        <span class="sr-only">Toggle navigation</span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
			      <a class="navbar-brand" href="#">Take & Wash</a>
			    </div>
			    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			      <ul class="nav navbar-nav">
			        <li class="active"><a href="#">Acceuil <span class="sr-only">(current)</span></a></li>
			        <li><a href="#">Tarifs</a></li>
			        <li class="dropdown">
			          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Commandes <span class="caret"></span></a>
			          <ul class="dropdown-menu">
			            <li><a href="#">Commander</a></li>
			            <li><a href="#">Mes commandes</a></li>
			          </ul>
			        </li>
			      </ul>
			      <ul class="nav navbar-nav navbar-right">
			        <li><a href="#">Nous contacter</a></li>
			        <li class="dropdown">
			          <a href="#" class="dropdown-toggle username-value" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Username <span class="caret"></span></a>
			          <ul class="dropdown-menu">
			            <li><a href="#">Paramètres</a></li>
			            <li><a href="#">Se déconnecter</a></li>
			          </ul>
			        </li>
			      </ul>
			    </div>
			</div>
		</nav>
	</div>
	<div class="loading alert alert-info blink" style="display: none;">
		<strong id="load-message">Loading...</strong>
	</div>
	<div class="popup-error alert alert-danger blink" style="display: none;">
		<strong id="error-message">Error...</strong>
	</div>
	
	<div class="order" style="display: none;">
			<div class="title">
				<h1>Commander -><strong>Take & Wash</strong></h1>
				<p>slogan</p>
			</div>
			<div class="card">
				<div class="header">
					<h2>Commande</h2>
					<p>Entrez vos informations pour commander:</p>
				</div>
				<div class="content">
					<form class="form-horizontal" role="form" id="order-form">
						<h3>Blanchisserie (linge quotidien):</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Repassage + pliage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price0" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg0" placeholder="Nombre de kg">
							</div>
							<label class="control-label col-sm-2" for="addressR">Lavage + séchage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price1" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg1" placeholder="Nombre de kg">
							</div>
							<label class="control-label col-sm-2" for="addressR">Lavage + séchage + repassage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price2" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg2" placeholder="Nombre de kg">
							</div>
						</div>
						<h3>Blanchisserie (linge de maison):</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Repassage + pliage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price3" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg3" placeholder="Nombre de kg">
							</div>
							<label class="control-label col-sm-2" for="addressR">Lavage + séchage + pliage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price4" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg4" placeholder="Nombre de kg">
							</div>
							<label class="control-label col-sm-2" for="addressR">Lavage + séchage + repassage ou calandrage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price5" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg5" placeholder="Nombre de kg">
							</div>
						</div>
						<h3>Chemise:</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Repassage + sur cintre:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price6" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg6" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Repassage + pliage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price7" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg7" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Lavage + repassage et sur cintre:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price8" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg8" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Lavage + repassage + pliage:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price9" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg9" placeholder="Nombre d'articles">
							</div>
						</div>
						<h3>Pressing:</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Veste / Veston:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price10" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg10" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Pantalon:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price11" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg11" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Costume:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price12" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg12" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Jupe simple / plissée:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price13" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg13" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Robe simple:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price14" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg14" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Robe de soirée:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price15" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg15" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Blouson:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price16" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg16" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Doudoune / Blouson ski:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price17" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg17" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Manteau / Imperméable / Trench:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price18" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg18" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Echarpe laine / Soie:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price19" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg19" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Cravate:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price20" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg20" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Pull / Gilet:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price21" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg21" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Chemisier simple / soie:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price22" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg22" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Couette synthétique:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price23" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg23" placeholder="Nombre d'articles">
							</div>
							<label class="control-label col-sm-2" for="addressR">Couette Plume:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="price24" placeholder="" disabled>
								<input type="" maxlength="256" class="form-control" id="kg24" placeholder="Nombre d'articles">
							</div>
						</div>
						<h3>Action sociale :  Faites un don de vos anciens vêtements:</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Don de vêtements:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="priceDon" placeholder="" value="Pas de coût supplémentaire" disabled>
								<input type="" maxlength="256" class="form-control" id="kgDon" placeholder="Nombre de kg">
						</div>
						<h3>Informations :</h3>	
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Adresse de retrait:</label>
							<div class="col-sm-10">
								<input type="text" maxlength="256" class="form-control" id="addressR" placeholder="Adresse de retrait">
								<div class="alert alert-danger" id="addressR-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="addressR-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="dateR">Date de retrait:</label>
							<div class="col-sm-10">
								<input type="text" class="form-control" id="dateR" placeholder="Date de retrait: jj/mm/aa hh:mm">
								<div class="alert alert-danger" id="dateR-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="dateR-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressL">Adresse de livraison:</label>
							<div class="col-sm-10">
								<input type="text" maxlength="256" class="form-control" id="addressL" placeholder="Adresse de livraison">
								<div class="alert alert-danger" id="addressL-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="addressL-error-message"></strong>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="dateL">Date de livraison:</label>
							<div class="col-sm-10">
								<input type="text" class="form-control" id="dateL" placeholder="Date de livraison: jj/mm/aa hh:mm">
								<div class="alert alert-danger" id="dateL-error" style="margin-top: 5px; margin-bottom: 0px; display: none;">
									<strong id="dateL-error-message"></strong>
								</div>
							</div>
						</div>
						<h3>Suppléments:</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR">Service express 48H</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="priceSupp" placeholder="" disabled>
								<label>Oui<input type="checkbox" id="cbox1" value="premiere_checkbox"></label><br>
						</div>
						<h3>Coûts:</h3>
						<div class="form-group">
							<label class="control-label col-sm-2" for="addressR" id="cout" value="0">Coûts:</label>
							<div class="col-sm-10">
								<input type="" maxlength="256" class="form-control" id="cout" placeholder="" disabled>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<center>
									<button type="button" class="btn btn-large btn-primary" id="btn-action-order">Commander</button>
								</center>
							</div>
						</div>
					</form>
				</div>
			</div>
			<br />
	</div>
	    
    <script type="text/javascript">
		$(document).ready(function() {
			
			var userIdCourant=0;
			
			$("#btn-register").click(function(){
				showMenu(".register");
			});
			
			$("#btn-login").click(function(){
				showMenu(".login");
			});
	
			$("#btn-action-login").click(function(){
				startLoad("Connexion...");
				
				var user = $("#login-form #user").val();
				var pwd = $("#login-form #pwd").val();
				
				var error = false;
				
				error |= verifyField("#login-form", user, "#user-error", "#user-error-message", "Le nom d'utilisateur", 4, 42);
				error |= verifyField("#login-form", pwd, "#pwd-error", "#pwd-error-message", "Le mot de passe", 4, 42);
				
				if (error) {
					stopLoad();
					return;
				}
				
				$.ajax({
					type: "GET",
			        contentType : 'application/json',
			        url: "v1/secure/onlylogged",
			        dataType: 'json',
			        beforeSend : function(req) {
			        	req.setRequestHeader("Authorization", "Basic " + btoa(user + ":" + pwd));
			        },
			        success: function (data){
			        	
			        	userIdCourant=data.id;
			        	
			        	if (data.id == 1) {
			        		document.location = '/html/board';
			        	}else{
				        	showMenu(".order");
				        	
				        	recupPriceBdd();
			        	}
			        	
			        	$(".username-value").html(cleanInput(user) + ' <span class="caret">');
			        	showMenu(".main");
			        },
			        error : function(jqXHR, textStatus, errorThrown) {
			       		showError("Mauvais nom d'utilisateur ou mot de passe!");
			       	}
			     });
			});
			
			$("#btn-action-register").click(function(){
				startLoad("Inscription...");
				
				var name = $("#register-form #name").val();
				var user = $("#register-form #user").val();
				var address = $("#register-form #address").val();
				var pwd = $("#register-form #pwd").val();
				var cpwd = $("#register-form #cpwd").val();
				
				var error = false;
				
				error |= verifyField("#register-form", name, "#name-error", "#name-error-message", "Le nom", 4, 128);
				error |= verifyField("#register-form", user, "#user-error", "#user-error-message", "Le nom d'utilisateur", 4, 64);
				error |= verifyField("#register-form", address, "#address-error", "#address-error-message", "L'address", 8, 256);
				error |= verifyField("#register-form", pwd, "#pwd-error", "#pwd-error-message", "Le mot de passe", 4, 42);
				
				if (pwd != cpwd) {
					if (!$("#register-form #cpwd-error").is(":visible")) {
						$("#register-form #cpwd-error").fadeIn();
					}
					error = true;
				} else if ($("#register-form #cpwd-error").is(":visible")) {
					$("#register-form #cpwd-error").fadeOut();
				}
		
				if (error) {
					stopLoad();
					return;
				}
				
				$.ajax({
					type : 'POST',
					contentType : 'application/json',
					url : "v1/userdb",
					dataType : "json",
					data : JSON.stringify({
						"name" : user,
						"alias" : name,
						"password" : pwd,
						"address" : address,
						"id" : 0
					}),
			        success: function (data){
			        	// $(".username-value").html(cleanInput(user) + ' <span class="caret">');
			        	// showMenu(".main");
			        	
			        	if (data.id == 1) {
			        		document.location = '/html/board';
			        	}else{
				        	showMenu(".order");
				        	
				        	for(var i=0; i<25 /*25+2*/; i++) {
				        		// alert("i: "+i);
				        		recupPriceBdd(i, i);
				        	}
			        	}
			        		
			        },
			        error : function(jqXHR, textStatus, errorThrown) {
			       		showError("Le nom d'utilisateur est déjà utilisé!");
			       	}
			     });
			});
			
			$("#btn-action-order").click(function(){
				startLoad("Commander...");
				
				// 00/00/00 00:00
				
				var user = $("#login-form #user").val();
				var pwd = $("#login-form #pwd").val();
				
				
				
				var addressR = $("#order-form #addressR").val();
				var dateR = $("#order-form #dateR").val();
				var addressL = $("#order-form #addressL").val();
				var dateL = $("#order-form #dateL").val();

				var error = false;
				
				error |= verifyField("#order-form", addressR, "#addressR-error", "#addressR-error-message", "L'addresse de retrait", 8, 256);
				error |= verifyField("#order-form", dateR, "#dateR-error", "#dateR-error-message", "La date de retrait", 14, 14);
				error |= verifyField("#order-form", addressL, "#addressL-error", "#addressL-error-message", "L'addresse de livraison", 8, 256);
				error |= verifyField("#order-form", dateL, "#dateL-error", "#dateL-error-message", "La date de livraison", 14, 14);
				
				var vData;
				
				$.ajax({
					type : 'GET',
					contentType : 'application/json',
					url : "v1/commanddb/",
					dataType : "json",
					beforeSend : function(req) {
			        	req.setRequestHeader("Authorization", "Basic " + btoa(user + ":" + pwd));
			        },/*
			        data : JSON.stringify({
						"id" : 0,
						"userid" : userIdCourant,
						"addressRetrait" : addressR,
						"addressLivraison" : addressL,
						"dateRetrait" : dateR,
						"dateLivraison" : dateL,
						"price" : cout,
						"details" : sDetails
					}),*/
					success : function(data, textStatus, jqXHR) {
						vData=data;
						alert("ok");
						console.log(data.id +" - "+ data.userid+" - "+data.addressRetrait+" - "+data.addressLivraison+" - "+data.dateRetrait+" - "+data.dateLivraison+" - "+data.price);
					},
					error : function(jqXHR, textStatus, errorThrown) {
						alert('error: ' + textStatus);
					}
				});
				
				// jj/mm/aa hh:mm
				// 0123456789				
				
				var erreurDate=false;
				
				if( dateR.substring(6, 8)<=dateL.substring(6, 8) && dateR.substring(3, 5)<=dateL.substring(3, 5) && dateR.substring(0, 2)<=dateL.substring(0, 2) ){
					if( jQuery("#order-form #cbox1").prop("checked") ){
						if(dateL.substring(0, 2)-dateR.substring(0, 2)<2){
							erreurDate=true;
						}
					}else{
						if(dateL.substring(0, 2)-dateR.substring(0, 2)<3){
							erreurDate=true;
						}
					}
				}else{
					erreurDate=true;					
				}
				
				/*
				if (pwd != cpwd) {
					if (!$("#register-form #cpwd-error").is(":visible")) {
						$("#register-form #cpwd-error").fadeIn();
					}
					error = true;
				} else if ($("#register-form #cpwd-error").is(":visible")) {
					$("#register-form #cpwd-error").fadeOut();
				}
				*/
				
				if (erreurDate) {
					alert("Probleme date");
					stopLoad();
					return;
				}
				
				if (error) {
					stopLoad();
					return;
				}
				
				var cout=parseFloat(0);
				//alert("cout 1 : "+cout);
				
				var sDetails="";
				
				$("#order-form #cout").val(cout);				
				
			
						
					for(var i=0; i<25; i++){
						var a=parseFloat($("#order-form #price"+i).val().substring( 0, ($("#order-form #price"+i).val().indexOf(" ")) ));
						//var a=$("#order-form #price"+i);
						//alert("a: "+a+" i: "+i);
						
						//alert("a: "+a);
						var b=parseFloat($("#order-form #kg"+i).val()/*.replace(",", ".")*/);
						// cout+=$("#order-form #price"+i).val()*$("#order-form #kg"+i).val();
						//alert("b: "+b+" i: "+i);
						cout+=a*b;
						//alert("cout 2 : "+cout);
						
	
						
					}
					
						sDetails+="LINGE_QUOTIDIEN_REPASSAGE_PLIAGE:"+$("#order-form #kg"+0).val()+";"+
						"LINGE_QUOTIDIEN_LAVAGE_SECHAGE:"+$("#order-form #kg"+1).val()+";"+
						"LINGE_QUOTIDIEN_LAVAGE_SECHAGE_REPASSAGE:"+$("#order-form #kg"+2).val()+";"+
						"LINGE_DE_MAISON_REPASSAGE_PLIAGE:"+$("#order-form #kg"+3).val()+";"+
						"LINGE_DE_MAISON_LAVAGE_SECHAGE:"+$("#order-form #kg"+4).val()+";"+
						"LINGE_DE_MAISON_LAVAGE_SECHAGE_REPASSAGE:"+$("#order-form #kg"+5).val()+";"+
						"CHEMISE_REPASSAGE_CINTRE:"+$("#order-form #kg"+6).val()+";"+
						"CHEMISE_REPASSAGE_PLIAGE:"+$("#order-form #kg"+7).val()+";"+
						"CHEMISE_LAVAGE_REPASSAGE_CINTRE:"+$("#order-form #kg"+8).val()+";"+
						"CHEMISE_LAVAGE_REPASSAGE_PLIAGE:"+$("#order-form #kg"+9).val()+";"+
						"PRESSING_VESTE_VESTON:"+$("#order-form #kg"+10).val()+";"+
						"PRESSING_PANTALON:"+$("#order-form #kg"+11).val()+";"+
						"PRESSING_COSTUME:"+$("#order-form #kg"+12).val()+";"+
						"PRESSING_JUPE_SIMPLE_PLISSEE:"+$("#order-form #kg"+13).val()+";"+
						"PRESSING_ROBE_SIMPLE:"+$("#order-form #kg"+14).val()+";"+
						"PRESSING_ROBE_DE_SOIREE:"+$("#order-form #kg"+15).val()+";"+
						"PRESSING_BLOUSON:"+$("#order-form #kg"+16).val()+";"+
						"PRESSING_DOUDOUNE_BLUSON_DE_SKI:"+$("#order-form #kg"+17).val()+";"+
						"PRESSING_MANTEAU_IMPERMEABLE_TRENCH:"+$("#order-form #kg"+18).val()+";"+
						"PRESSING_ECHARPE_LAINE_SOIE:"+$("#order-form #kg"+19).val()+";"+
						"PRESSING_CRAVATE:"+$("#order-form #kg"+20).val()+";"+
						"PRESSING_PULL_GILET:"+$("#order-form #kg"+21).val()+";"+
						"PRESSING_CHEMISIER_SIMPLE_SOIE:"+$("#order-form #kg"+22).val()+";"+
						"PRESSING_COUETTE_SYNTHETIQUE:"+$("#order-form #kg"+23).val()+";"+
						"PRESSING_COUETTE_PLUME:"+$("#order-form #kg"+24).val();
					
					$("#order-form #cout").val(cout);				

										
				
				$.ajax({
					type : 'POST',
					contentType : 'application/json',
					url : "v1/commanddb/",
					dataType : "json",
					beforeSend : function(req) {
			        	req.setRequestHeader("Authorization", "Basic " + btoa(user + ":" + pwd));
			        },
			        data : JSON.stringify({
						"id" : 0,
						"userid" : userIdCourant,
						"addressRetrait" : addressR,
						"addressLivraison" : addressL,
						"dateRetrait" : dateR,
						"dateLivraison" : dateL,
						"price" : cout,
						"details" : sDetails
					}),
					success : function(data, textStatus, jqXHR) {
						alert("ok");
						console.log(data.id +" - "+ data.userid+" - "+data.addressRetrait+" - "+data.addressLivraison+" - "+data.dateRetrait+" - "+data.dateLivraison+" - "+data.price);
					},
					error : function(jqXHR, textStatus, errorThrown) {
						alert('error: ' + textStatus);
					}
				});
				
			});
	
		});
		
		var showMenu = function(div) {
			if (!$(div).is(":visible")) {
				stopLoad();
				if ($('.login').is(":visible")) {
					$('.login').fadeOut(400, function() {
						$(div).fadeIn(400);
					});
				} else if ($('.register').is(":visible")) {
					$('.register').fadeOut(400, function() {
						$(div).fadeIn(400);
					});
				}
			}
		};
		
		var startLoad = function(message) {
			$("#load-message").text(message);
			$(".loading").fadeIn(400);
		};
		
		var stopLoad = function() {
			if ($('.loading').is(":visible")) {
				$(".loading").fadeOut(400);
			}
		};
		
		var verifyField = function(form, value, error, errorMessage, columnName, minLength, maxLength) {
			/*
			if(value==undefined){
				alert("Un champ obligatoire est actuellement vide");
			}else{
			*/
			if (value.length == 0) {
				$(form + " " + errorMessage).text(columnName + " est requis");
				if (!$(form + " " + error).is(":visible")) {
					$(form + " " + error).fadeIn();
				}
				return true;
			} else if (value.length < minLength) {
				$(form + " " + errorMessage).text(columnName + " est trop court");
				if (!$(form + " " + error).is(":visible")) {
					$(form + " " + error).fadeIn();
				}
				return true;
			} else if (value.length > maxLength) {
				$(form + " " + errorMessage).text(columnName + " est trop long");
				if (!$(form + " " + error).is(":visible")) {
					$(form + " " + error).fadeIn();
				}
				return true;
			} else if ($(form + " " + error).is(":visible")) {
				$(form + " " + error).fadeOut();
			}
			/*
			}*/
			return false;
		};
		
		var showError = function(error) {
			$(".loading").hide();
			$("#error-message").text(error);
			$('.popup-error').fadeIn(400, function() {
				setTimeout(function() {
					$('.popup-error').fadeOut(400);
				}, 2000);
			});
		};
		
		function isValidEmailAddress(emailAddress) {
			var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
			return pattern.test(emailAddress);
		};
		
		function cleanInput(input) {
			return $('<div/>').text(input).text();
		}
    </script>
</body>
</html>